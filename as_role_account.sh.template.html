<!DOCTYPE html>  <html> <head>   <title>as_role_account.sh.template.sh</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <ul class="sections">           <li id="title">             <div class="annotation">                 <h1>as_role_account.sh.template.sh</h1>             </div>         </li>                              <li id="section-1">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                           <p>run as role account</p>

             </div>                          <div class="content"><div class="highlight"><pre><span class="nb">set</span> -eux

mkdir archivesspace
<span class="nb">cd </span>archivesspace
mkdir lib
curl https://archivesspace.s3.amazonaws.com/public-files/archivesspace.%<span class="o">{</span>TAG<span class="o">}</span>.jar -o lib/archivesspace.jar</pre></div></div>                      </li>                              <li id="section-2">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>                           

<p>need to hack the jar to put in our customized templates</p>

             </div>                          <div class="content"><div class="highlight"><pre>mkdir -p lib/frontend/WEB-INF/app/views/site/
curl https://raw.github.com/tingletech/aws-as/master/_footer.html.erb -o lib/frontend/WEB-INF/app/views/site/_footer.html.erb
<span class="nb">cd </span>lib
zip -u archivesspace.jar frontend/WEB-INF/app/views/site/_footer.html.erb
<span class="nb">cd</span> ..
curl http://repo1.maven.org/maven2/mysql/mysql-connector-java/5.1.21/mysql-connector-java-5.1.21.jar -o lib/mysql-connector-java-5.1.21.jar
curl https://s3.amazonaws.com/archivesspace/public-files/as-build.%<span class="o">{</span>TAG<span class="o">}</span>.zip -o as-build.zip
mkdir log
mkdir config</pre></div></div>                      </li>                              <li id="section-3">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>                           

<p>create config/config.rb, pointing to the AWS RDS mysql DB that we've started</p>

             </div>                          <div class="content"><div class="highlight"><pre>cat &gt; config/config.rb <span class="s">&lt;&lt; RAILSCONFIG</span>
<span class="s">AppConfig[:db_url] = &quot;%{DB_URL}&quot;</span>
<span class="s">AppConfig[:backend_url] = &quot;http://localhost:8089&quot;</span>
<span class="s">AppConfig[:frontend_url] = &quot;http://localhost:8080&quot;</span>
<span class="s">AppConfig[:public_url] = &quot;http://localhost:8081&quot;</span>
<span class="s">AppConfig[:search_user_secret] = &quot;%{PW1}&quot;</span>
<span class="s">AppConfig[:public_user_secret] = &quot;%{PW2}&quot;</span>
<span class="s">RAILSCONFIG</span></pre></div></div>                      </li>                              <li id="section-4">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>                           

<p>end of here file with config.rb </p>

             </div>                          <div class="content"><div class="highlight"><pre>chmod 600 config/config.rb</pre></div></div>                      </li>                              <li id="section-5">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>                           

<p>unzip as-build.zip
./build/run db:migrate</p>

             </div>                      </li>                              <li id="section-6">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>                           

<p>set up jar style as a back up
wget https://raw.github.com/gist/3519687/archivesspace.sh
need a better way to do this ... keep having to update the version</p>

             </div>                          <div class="content"><div class="highlight"><pre>wget https://raw.github.com/tingletech/aws-as/master/archivesspace.sh
chmod a+x archivesspace.sh</pre></div></div>                      </li>                              <li id="section-7">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>                           

<p>./archivesspace.sh start</p>

             </div>                      </li>                              <li id="section-8">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>                           

<p>set up tomcat style 
https://github.com/tingletech/twincat SNAC style â€–tomcat </p>

             </div>                          <div class="content"><div class="highlight"><pre><span class="nb">cd</span>
git clone https://github.com/tingletech/twincat.git
<span class="nb">cd </span>twincat
./grabcat.sh 
./clonecat.sh appFront 8080 12005
./clonecat.sh appBack 8089 12006
./clonecat.sh public 8081 12007
./clonecat.sh solr 8082 12008
  </pre></div></div>                      </li>                              <li id="section-9">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>                           

<p>install war files into tomcat</p>

             </div>                          <div class="content"><div class="highlight"><pre>curl https://archivesspace.s3.amazonaws.com/public-files/frontend.%<span class="o">{</span>TAG<span class="o">}</span>.war -o appFront/webapps/ROOT.war
curl https://archivesspace.s3.amazonaws.com/public-files/backend.%<span class="o">{</span>TAG<span class="o">}</span>.war -o appBack/webapps/ROOT.war
curl https://archivesspace.s3.amazonaws.com/public-files/public.%<span class="o">{</span>TAG<span class="o">}</span>.war -o public/webapps/ROOT.war
curl http://repo1.maven.org/maven2/org/apache/solr/solr/4.0.0/solr-4.0.0.war -o solr/webapps/ROOT.war</pre></div></div>                      </li>                              <li id="section-10">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>                           

<p>this used to work to set up the conf file</p>

             </div>                          <div class="content"><div class="highlight"><pre>cp -p ~/archivesspace/config/config.rb appFront/conf
cp -p ~/archivesspace/config/config.rb appBack/conf
cp -p ~/archivesspace/config/config.rb public/conf</pre></div></div>                      </li>                              <li id="section-11">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>                           

<p>install the GPL mysql library</p>

             </div>                          <div class="content"><div class="highlight"><pre>cp -p ~/archivesspace/lib/mysql-connector-java-5.1.21.jar tomcat/lib/</pre></div></div>                      </li>                              <li id="section-12">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>                           

<p>tweak the template</p>

             </div>                          <div class="content"><div class="highlight"><pre><span class="nb">cd</span>
<span class="nb">cd </span>twincat</pre></div></div>                      </li>                              <li id="section-13">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>                           

<p>_   _     _       _ <br />
| | | |   (<em>)     (</em>) <br />
| |<em>| |</em>_  _ <strong>_   _ <em></strong>   <strong></em>  <em></strong> <br />
| <strong>| '</em> \| / <em>_| | / _</em>| / <em>_|/ _ \ <br />
| |</em>| | | | __ \ | __ \ __ \ (<em>) | <br />
_</em>|<em>| |</em>|<em>|</em></strong>/ |<em>|<strong></em>/ |<em></strong>/_</em>_/               </p>

<p>_ <br />
| | <br />
| | <em>_ _ _ _</em> <strong>_   <em></strong> <br />
| |/ _<code>| '_</code> _ \ / _ \ <br />
| | (</em>| | | | | | |  <strong>/ <br />
|<em>|_</em>,<em>|</em>| |<em>| |</em>|_</strong>|                           </p>

             </div>                      </li>                              <li id="section-14">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>                           

<p>needs to be a better way to modify the template of a .war file
- OR -
we need to NOT SUPPORT .war distribution.  Who is going to want to run 
it in tomcat and not customize it? <br />
unpack the @@@@@ ##### .war file; by starting up tomcat...</p>

             </div>                          <div class="content"><div class="highlight"><pre>./wrapper.sh appFront ./tomcat/bin/startup.sh</pre></div></div>                      </li>                              <li id="section-15">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>                           

<p>wait for the .war to unzip so we can mess around in there</p>

             </div>                          <div class="content"><div class="highlight"><pre>sleep 30  </pre></div></div>                      </li>                              <li id="section-16">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>                           

<p>shutdown.sh don't work right here, just kill it</p>

             </div>                          <div class="content"><div class="highlight"><pre>pkill java

<span class="nb">cd </span>appFront/webapps</pre></div></div>                      </li>                              <li id="section-17">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>                           

<p>add in our custom footer template</p>

             </div>                          <div class="content"><div class="highlight"><pre>curl https://raw.github.com/tingletech/aws-as/master/_footer.html.erb -o ROOT/WEB-INF/app/views/site/_footer.html.erb</pre></div></div>                      </li>                              <li id="section-18">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>                           

<h1>need to put a sed in here to switch out the URL for the help documentation</h1>

<h1>sed -e ... http://aspace.hudmol.com/help/Default.htm  http://www.archivesspace.org/get-involved/software-testing-help/  ROOT/WEB-INF/config/help.yml</h1>

             </div>                      </li>                              <li id="section-19">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>                           

<p>set up solr ...</p>

             </div>                          <div class="content"><div class="highlight"><pre>mkdir -p ~/aspace-solr-data
<span class="nb">cd</span> ~/archivesspace/
mkdir solr
<span class="nb">cd </span>solr
unzip ../lib/archivesspace.jar schema.xml solrconfig.xml stopwords.txt synonyms.txt</pre></div></div>                      </li>                              <li id="section-20">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>                           

<p>set up tomcats</p>

             </div>                          <div class="content"><div class="highlight"><pre><span class="nb">cd</span> ~/twincat
cat &gt; appFront/bin/setenv.sh <span class="s">&lt;&lt; SETENV</span>
<span class="s">export JAVA_OPTS=&quot;\\\$JAVA_OPTS -Daspace.config=/home/aspace/archivesspace/config/config.rb -Dsolr.data.directory=/home/aspace/aspace-solr-data&quot;</span>
<span class="s">export CLASSPATH=&quot;\\\$CLASSPATH:/home/aspace/archivesspace/solr&quot;</span>
<span class="s">SETENV</span>
cp -rp appFront/bin/setenv.sh appBack/bin/setenv.sh
cp -rp appFront/bin/setenv.sh public/bin/setenv.sh</pre></div></div>                      </li>                              <li id="section-21">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>                           

<p>finally, start up the tomcats!</p>

             </div>                          <div class="content"><div class="highlight"><pre>./wrapper.sh appBack ./tomcat/bin/startup.sh
sleep 30</pre></div></div>                      </li>                              <li id="section-22">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>                           

<p>migrate the database</p>             </div>                          <div class="content"><div class="highlight"><pre>curl -v -X POST http://localhost:8089/setup/update_schema
./wrapper.sh appFront ./tomcat/bin/startup.sh
./wrapper.sh public ./tomcat/bin/startup.sh

</pre></div></div>                      </li>              </ul>    </div> </body> </html> 